{% extends "_we.html" %}

{% block dialog %}

<div class="modal fade" id="dlg" tabindex="-1" role="dialog" 
  aria-labelledby="dlg-label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="dlg-label">FIXME</h4>
      </div>
      <div class="modal-body" id="add-post-body">
        <table class="table table-striped table-hover table-bordered">
          <tbody>
            <tr>
              <th>Content</th>
              <td colspan="2"><input type="text" field="content" default=""
                         class="form-control" placeholder="Add content here..."/>
              </td>
            </tr>
            <tr>
              <th>Created</th>
              <td colspan="2"><input class="form-control datetimepicker" type="text"
                         field="created" placeholder="YYYY-MM-DD HH:MM" default=""/>
              </td>
            </tr>
            <tr>
              <th>Background</th>
              <td>
                <select class="form-control" field="background" default="1">
                  <option value="1">Picture 01</option>
                  <option value="2">Picture 02</option>
                  <option value="3">Picture 03</option>
                  <option value="4">Picture 04</option>
                  <option value="5">Picture 05</option>
                  <option value="6">Picture 06</option>
                  <option value="7">Picture 07</option>
                  <option value="8">Picture 08</option>
                  <option value="9">Picture 09</option>
                  <option value="10">Picture 10</option>
                  <option value="11">Picture 11</option>
                  <option value="12">Picture 12</option>
                  <option value="13">Picture 13</option>
                  <option value="14">Picture 14</option>
                  <option value="15">Picture 15</option>
                  <option value="16">Picture 16</option>
                  <option value="17">Picture 17</option>
                  <option value="18">Picture 18</option>
                  <option value="19">Picture 19</option>
                  <option value="20">Picture 20</option>
                  <option value="21">Picture 21</option>
                  <option value="22">Picture 22</option>
                  <option value="23">Picture 23</option>
                  <option value="24">Picture 24</option>
                  <option value="25">Picture 25</option>
                  <option value="26">Picture 26</option>
                  <option value="27">Picture 27</option>
                  <option value="28">Picture 28</option>
                  <option value="29">Picture 29</option>
                  <option value="30">Picture 30</option>
                  <option value="color:d96060">Color 01</option>
                  <option value="color:108fe6">Color 02</option>
                  <option value="color:ea8fbc">Color 03</option>
                  <option value="color:7cbbe6">Color 04</option>
                  <option value="color:e28363">Color 05</option>
                  <option value="color:d9609b">Color 06</option>
                  <option value="color:ff5d26">Color 07</option>
                  <option value="color:7ddad5">Color 08</option>
                  <option value="color:6a52ea">Color 09</option>
                  <option value="color:f1c200">Color 10</option>
                  <option value="color:60add9">Color 11</option>
                  <option value="color:26ffe0">Color 12</option>
                  <option value="color:e58500">Color 13</option>
                  <option value="color:ff955c">Color 14</option>
                  <option value="color:8cff8c">Color 15</option>
                  <option value="color:60d9ab">Color 16</option>
                  <option value="color:6cd6ff">Color 17</option>
                  <option value="color:8597d5">Color 18</option>
                  <option value="color:84d6a1">Color 19</option>
                  <option value="color:66923a">Color 20</option>
                  <option value="color:8f60d9">Color 21</option>
                  <option value="color:ff697b">Color 22</option>
                  <option value="color:9f619c">Color 23</option>
                  <option value="color:ff7535">Color 24</option>
                  <option value="color:fff226">Color 25</option>
                  <option value="color:dc7053">Color 26</option>
                  <option value="color:6690bb">Color 27</option>
                  <option value="color:8eb862">Color 28</option>
                  <option value="color:c47100">Color 29</option>
                  <option value="color:efff2e">Color 30</option>
                </select>
              </td>
              <td rowspan="6">
                <img class="background" src="" alt="Background"/>
              </td>
            </tr>
            <tr>
              <th>Role</th>
              <td>
                <select class="form-control" field="role" default="anonymous">
                  <option value="anonymous">Anonymous</option>
                  <option value="company">Company</option>
                  <option value="industry">Industry</option>
                  <option value="position">Position</option>
                  <option value="expertise">Expertise</option>
                </select>
              </td>
            </tr>
            <tr>
              <th>Role Text</th>
              <td><input type="text" field="role_text" default=""
                         class="form-control" placeholder="Role description"/>
              </td>
            </tr>
            <tr>
              <th>Theme</th>
              <td><input type="text" disabled="disabled" default="general"
                         class="form-control" value="general" field="theme"/>
              </td>
            </tr>
            <tr>
              <th>Up Votes</th>
              <td><input type="text" field="upvote_count" default="0"
                         class="form-control" value="0"/>
              </td>
            </tr>
            <tr>
              <th>Down Votes</th>
              <td><input type="text" field="downvote_count" default="0"
                         class="form-control" value="0"/>
              </td>
            </tr>
            <tr>
              <th>Channel</th>
              <td>
                <select class="form-control" field="channel" default="{{ channels[0].key }}">
                {% for channel in channels %}
                  <option value="{{ channel.key }}">{{ channel.title }}</option>
                {% endfor %}
                </select>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="dlg-submit">Save</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block js %}
<script>
var channelMap = {
{% for channel in channels %}
  "{{ channel.key }}" : "{{ channel.title }}"{% if not loop.last %},{% endif %}
{% endfor %}
};
var columns = [
  { 
    title: 'Created',
    attr: 'created',
    class: 'edit_post'
  },
  { 
    title: 'Content',
    attr: 'content',
    class: 'edit_post'
  },
  { 
    title: 'Comments',
    attr: function (item) {
        return $('<a>').append(item.comment_count).prop(
            'href', '/_we/comments/' + item.key);
    },
    class: 'comment'
  },
  { 
    title: 'Up Votes',
    attr: 'upvote_count'
  },
  { 
    title: 'Down Votes',
    attr: 'downvote_count'
  },
  { 
    title: 'Flagged',
    attr: function (item) {
      return item.flagged ? 'true' : 'false';
    }
  },
  { 
    title: 'User',
    attr: 'user'
  },
  { 
    title: 'Channel',
    attr: function (item) {
      var channelKey = item.channels
      var channelTitle = "Unknown channel";
      if (channelKey in channelMap)
        channelTitle = channelMap[channelKey];
      return $('<a>').append(channelTitle).prop(
            'href', '/link/to/' + item.key);
    }
  },
  { 
    title: 'Post ID',
    attr: 'key'
  }
];

var url_base = '/_we/js/posts/';
var url_post_base = '/_we/js/posts/';
var url_put_base = '/_we/js/posts/';
var obj_key = '';
var obj_type = 'Post';

$('#items').on('click', 'td.comment', function() {
    var href = $(this).find('a').attr('href');
    window.location.href = href;
});


$('select.form-control').on('change', function (e) {
    var valueSelected = this.value;
    var colorPrefix = "color:";
    var img = $('img.background');
    var td = img.closest('td');
    if (valueSelected.startsWith(colorPrefix)) {
        td.css('background-color', '#' + valueSelected.substring(colorPrefix.length));
        img.prop("src", "");
    }
    else {
        td.css('background-color', '#FFFFFF');
        img.prop("src", "/static/thumbs/" + valueSelected + ".jpg");
    }

});

</script>
{% endblock %}
